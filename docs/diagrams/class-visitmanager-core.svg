<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="948px" preserveAspectRatio="none" style="width:1487px;height:948px;" version="1.1" viewBox="0 0 1487 948" width="1487px" zoomAndPan="magnify"><defs><filter height="300%" id="f4ururbabcox0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><rect width="100%" height="100%" fill="#FFFFFF"/><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="526" x="486.5" y="16.708">VisitManager: ключевые классы обслуживания визитов</text><!--MD5=[61822be37010654d6114c931cb592711]
cluster Сервисный слой--><polygon fill="#FFFFFF" filter="url(#f4ururbabcox0)" points="221,44.9531,363,44.9531,370,67.25,1305,67.25,1305,337.9531,221,337.9531,221,44.9531" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="221" x2="370" y1="67.25" y2="67.25"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="225" y="59.9482">Сервисный слой</text><!--MD5=[86d93fb63e28a7264ba83be64d9dc6a2]
cluster Интеграции--><polygon fill="#FFFFFF" filter="url(#f4ururbabcox0)" points="1329,246.9531,1431,246.9531,1438,269.25,1465,269.25,1465,337.9531,1329,337.9531,1329,246.9531" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1329" x2="1438" y1="269.25" y2="269.25"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="1333" y="261.9482">Интеграции</text><!--MD5=[9f237a66e87452de5f157643e7b7faac]
cluster Домен--><polygon fill="#FFFFFF" filter="url(#f4ururbabcox0)" points="22,386.9531,81,386.9531,88,409.25,713,409.25,713,936.9531,22,936.9531,22,386.9531" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="88" y1="409.25" y2="409.25"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="26" y="401.9482">Домен</text><!--MD5=[a928950a7807a79b8234feadd5d78369]
class VisitService--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="103.9922" id="VisitService" style="stroke: #A80036; stroke-width: 1.5;" width="407" x="630.5" y="79.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="798.5" y="96.0918">VisitService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="631.5" x2="1036.5" y1="103.9219" y2="103.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="631.5" x2="1036.5" y1="111.9219" y2="111.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="177" x="636.5" y="126.1323">+Visit getVisit(branchId, visitId)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="234" x="636.5" y="138.937">+List&lt;Visit&gt; getVisits(branchId, queueId)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="395" x="636.5" y="151.7417">+Visit createVisit(branchId, entryPointId, VisitParameters, printTicket)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="211" x="636.5" y="164.5464">+Visit visitPostPone(branchId, visitId)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="193" x="636.5" y="177.3511">+void deleteVisit(branchId, visitId)</text><!--MD5=[6ad6945def856d0748cfc6785c16a6a7]
class BranchService--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="BranchService" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="237.5" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="240.5" y="298.0918">BranchService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="238.5" x2="331.5" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238.5" x2="331.5" y1="313.9219" y2="313.9219"/><!--MD5=[8736b572be702d5ae6361a5a5cce2687]
class EventService--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="EventService" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="448" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="451" y="298.0918">EventService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="449" x2="533" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="449" x2="533" y1="313.9219" y2="313.9219"/><!--MD5=[af68eece8ad687dae42ca2e9a5f9b6a5]
class DelayedEvents--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="DelayedEvents" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="594" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="92" x="597" y="298.0918">DelayedEvents</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="595" x2="691" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="595" x2="691" y1="313.9219" y2="313.9219"/><!--MD5=[a6c411ece6777481b4f534d8d2f1b805]
class PrinterService--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="PrinterService" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="787.5" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="87" x="790.5" y="298.0918">PrinterService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="788.5" x2="879.5" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="788.5" x2="879.5" y1="313.9219" y2="313.9219"/><!--MD5=[10f4b58fdc66df72f029f4b636d1b57f]
class SegmentationRule--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="SegmentationRule" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="925.5" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="115" x="928.5" y="298.0918">SegmentationRule</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="926.5" x2="1045.5" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="926.5" x2="1045.5" y1="313.9219" y2="313.9219"/><!--MD5=[64ea2f2265774a3820a42137cd330fcd]
class CallRule--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="CallRule" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="1150.5" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="1153.5" y="298.0918">CallRule</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1151.5" x2="1204.5" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1151.5" x2="1204.5" y1="313.9219" y2="313.9219"/><!--MD5=[8c55c79778dd70b9440459d26f3f5f5a]
class KeyCloackClient--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="KeyCloackClient" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="1345.5" y="281.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="97" x="1348.5" y="298.0918">KeyCloackClient</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1346.5" x2="1447.5" y1="305.9219" y2="305.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1346.5" x2="1447.5" y1="313.9219" y2="313.9219"/><!--MD5=[6d7d587a021629470fd0d5f8ef3407c9]
class Branch--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="91.1875" id="Branch" style="stroke: #A80036; stroke-width: 1.5;" width="283" x="143.5" y="421.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="44" x="263" y="438.0918">Branch</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="144.5" x2="425.5" y1="445.9219" y2="445.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="204" x="149.5" y="460.1323">+HashMap&lt;String, Queue&gt; queues</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="271" x="149.5" y="472.937">+HashMap&lt;String, ServicePoint&gt; servicePoints</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="185" x="149.5" y="485.7417">+HashMap&lt;String, User&gt; users</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="144.5" x2="425.5" y1="492.3359" y2="492.3359"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="149.5" y="506.5464">+HashMap&lt;String, Visit&gt; getAllVisits()</text><!--MD5=[15b0de36700cf8bf422172734e699e19]
class Queue--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="52.7734" id="Queue" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="72.5" y="586.4531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="41" x="110.5" y="602.5918">Queue</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="73.5" x2="188.5" y1="610.4219" y2="610.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="78.5" y="624.6323">+List&lt;Visit&gt; visits</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="73.5" x2="188.5" y1="631.2266" y2="631.2266"/><!--MD5=[5c6bdac1067f19015598057cf3c0e827]
class ServicePoint--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="78.3828" id="ServicePoint" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="226.5" y="573.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="246.5" y="590.0918">ServicePoint</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="227.5" x2="342.5" y1="597.9219" y2="597.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="232.5" y="612.1323">+User user</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="232.5" y="624.937">+Visit visit</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="232.5" y="637.7417">+List&lt;Visit&gt; visits</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="227.5" x2="342.5" y1="644.3359" y2="644.3359"/><!--MD5=[3fd616f346a44cd59a91eb10b19e157c]
class User--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="52.7734" id="User" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="441.5" y="586.4531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="29" x="485.5" y="602.5918">User</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="442.5" x2="557.5" y1="610.4219" y2="610.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="105" x="447.5" y="624.6323">+List&lt;Visit&gt; visits</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="442.5" x2="557.5" y1="631.2266" y2="631.2266"/><!--MD5=[e049a9fc6087ec9a0b5519edf8a49765]
class Visit--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="91.1875" id="Visit" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="213" y="728.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="26" x="303" y="745.0918">Visit</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="214" x2="418" y1="752.9219" y2="752.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="219" y="767.1323">+String id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="83" x="219" y="779.937">+String status</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="194" x="219" y="792.7417">+ZonedDateTime createDateTime</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="167" x="219" y="805.5464">+List&lt;VisitEvent&gt; visitEvents</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="214" x2="418" y1="812.1406" y2="812.1406"/><!--MD5=[e9199e5d83860710d0f0a7459559bf32]
class VisitEventInformation--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="VisitEventInformation" style="stroke: #A80036; stroke-width: 1.5;" width="138" x="194" y="880.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="197" y="897.0918">VisitEventInformation</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="195" x2="331" y1="904.9219" y2="904.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="195" x2="331" y1="912.9219" y2="912.9219"/><!--MD5=[7c89ce455441375b65ed2921a6a13cde]
class VisitEvent--><rect fill="#FEFECE" filter="url(#f4ururbabcox0)" height="39.9688" id="VisitEvent" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="367.5" y="880.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="61" x="370.5" y="897.0918">VisitEvent</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="368.5" x2="433.5" y1="904.9219" y2="904.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="368.5" x2="433.5" y1="912.9219" y2="912.9219"/><!--MD5=[74bf68b22fb1621006db700a076feeed]
link VisitService to BranchService--><path d="M630.43,149.2331 C515.92,161.6531 386.62,182.1531 339,213.9531 C316.55,228.9431 301.74,256.7531 293.4,276.9031 " fill="none" id="VisitService-&gt;BranchService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="291.52,281.5931,298.5764,274.7224,293.377,276.9507,291.1486,271.7513,291.52,281.5931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="340" y="227.02">конфигурация отделения</text><!--MD5=[cf99a0e6e886722ef32685d5c7192562]
link VisitService to EventService--><path d="M630.31,166.9131 C598.37,178.3331 567.28,193.5831 541,213.9531 C520.31,229.9931 506.68,257.1731 498.95,276.8931 " fill="none" id="VisitService-&gt;EventService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="497.12,281.7431,504.0512,274.7461,498.8928,277.068,496.571,271.9096,497.12,281.7431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="542" y="227.02">события визита</text><!--MD5=[c758cf680a2fdfefd23acf09b0e92ee9]
link VisitService to DelayedEvents--><path d="M706.14,184.1631 C693.52,192.7831 681.79,202.6731 672,213.9531 C656.65,231.6531 649.36,257.7531 645.94,276.7431 " fill="none" id="VisitService-&gt;DelayedEvents" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="645.08,281.9031,650.5167,273.6908,645.9089,276.9723,642.6275,272.3645,645.08,281.9031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="673" y="227.02">отложенные события</text><!--MD5=[ab866ab3ea45a300cd2381d13e721b0f]
link VisitService to PrinterService--><path d="M831.43,184.0631 C830.94,199.1631 830.67,215.7231 831,230.9531 C831.33,246.2031 832.05,263.3031 832.71,276.7831 " fill="none" id="VisitService-&gt;PrinterService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="832.97,281.9431,836.5011,272.749,832.7125,276.9498,828.5117,273.1611,832.97,281.9431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="832" y="227.02">печать талонов</text><!--MD5=[834af8e79e14dfd230a9d66a13bb25c3]
link VisitService to KeyCloackClient--><path d="M1037.67,160.5731 C1107.64,173.0831 1185.74,190.4731 1255,213.9531 C1297.88,228.4931 1341.45,257.8031 1368.8,278.3731 " fill="none" id="VisitService-&gt;KeyCloackClient" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1373.05,281.5931,1368.3041,272.9632,1369.0689,278.5681,1363.464,279.3329,1373.05,281.5931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1294" y="227.02">пользователи и роли</text><!--MD5=[442118e67b881bb58e001038f986c91a]
link VisitService to SegmentationRule--><path d="M916.62,184.1431 C927.68,193.2031 938.22,203.2031 947,213.9531 C962.22,232.5831 972.73,258.1031 978.97,276.6831 " fill="none" id="VisitService-&gt;SegmentationRule" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="980.62,281.7231,981.6218,271.9253,979.0646,276.9712,974.0187,274.414,980.62,281.7231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="959" y="227.02">сегментация потоков</text><!--MD5=[64c22553cca467f3ed6609ad4fc3edbe]
link VisitService to CallRule--><path d="M1037.51,172.2531 C1066.05,182.9731 1093.84,196.6131 1118,213.9531 C1140.4,230.0231 1157.18,257.2031 1167.21,276.9131 " fill="none" id="VisitService-&gt;CallRule" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1169.62,281.7531,1169.1854,271.9139,1167.3897,277.2781,1162.0254,275.4824,1169.62,281.7531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1137" y="227.02">правила вызова</text><!--MD5=[137133cc77ce1ec2e3773f56ef539f7b]
link BranchService to Branch--><path d="M285,322.0331 C285,345.0531 285,384.6631 285,416.5831 " fill="none" id="BranchService-&gt;Branch" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="285,421.6431,289,412.6431,285,416.6431,281,412.6431,285,421.6431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="286" y="367.02">возвращает состояние</text><!--MD5=[f6a1aa7ee2b8db32efde7c7cac2a7ee5]
reverse link Branch to Queue--><path d="M227.55,521.9831 C203.99,543.9431 177.81,568.3331 158.66,586.1831 " fill="none" id="Branch&lt;-Queue" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="237.12,513.0731,230.0038,514.2394,228.3434,521.2567,235.4596,520.0905,237.12,513.0731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="221.1759" y="533.2698">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="157.247" y="575.3666">*</text><!--MD5=[2ce2188abde5c1138ca4c7d31fc95916]
reverse link Branch to ServicePoint--><path d="M285,526.1831 C285,542.1531 285,559.0931 285,573.6531 " fill="none" id="Branch&lt;-ServicePoint" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="285,513.0731,281,519.0731,285,525.0731,289,519.0731,285,513.0731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="276.3875" y="533.2698">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="277.4203" y="562.9481">*</text><!--MD5=[970067afbdb7393561ef2e1a995cafa4]
reverse link Branch to User--><path d="M363.05,520.5531 C396.63,542.9631 434.35,568.1431 461.7,586.3831 " fill="none" id="Branch&lt;-User" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="351.85,513.0731,354.6215,519.7304,361.8326,519.7326,359.0611,513.0753,351.85,513.0731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="353.4739" y="533.2698">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="444.5112" y="575.1893">*</text><!--MD5=[a627f750c035aef3ff6b2a55296cc550]
reverse link Queue to Visit--><path d="M102.82,650.9631 C94.41,666.7131 89.83,684.6831 100,698.9531 C125.91,735.2931 170.76,754.0831 212.9,763.7231 " fill="none" id="Queue&lt;-Visit" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="109.81,639.4631,103.2763,642.5144,103.5799,649.7191,110.1136,646.6678,109.81,639.4631" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="101" y="695.02">ожидающие визиты</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="95.9848" y="659.4364">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="198.0716" y="759.4492">*</text><!--MD5=[07a923935ad3c83ba2ce51e0b6a0485f]
reverse link ServicePoint to Visit--><path d="M251.87,664.3131 C248.02,675.6731 246.78,687.6931 251,698.9531 C254.98,709.5631 261.22,719.6531 268.31,728.7831 " fill="none" id="ServicePoint&lt;-Visit" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="256.92,652.3231,250.9045,656.2997,252.2615,663.382,258.2771,659.4054,256.92,652.3231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="252" y="695.02">пул визитов</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="243.4063" y="672.4243">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="253.7915" y="718.0367">*</text><!--MD5=[07a923935ad3c83ba2ce51e0b6a0485f]
reverse link ServicePoint to Visit--><path d="M330.83,663.2231 C334.53,669.2031 337.72,675.5031 340,681.9531 C345.31,696.9731 343.15,713.7431 338.42,728.7831 " fill="none" id="ServicePoint&lt;-Visit-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="323.19,652.1331,323.2999,659.3434,329.9979,662.0151,329.8879,654.8048,323.19,652.1331" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="344" y="695.02">активный визит</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="321.2801" y="672.4926">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="315.9504" y="718.0367">0..1</text><!--MD5=[1732ef40fe141570229cb416b418e147]
reverse link User to Visit--><path d="M490.13,652.4031 C484.53,668.2831 476.15,685.9731 464,698.9531 C451.32,712.4931 435.63,723.9431 419.26,733.4931 " fill="none" id="User&lt;-Visit" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="494.19,639.6231,488.5584,644.1271,490.5499,651.0577,496.1815,646.5538,494.19,639.6231" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="477" y="695.02">обслуживаемые визиты</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="484.0441" y="659.204">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="427.1002" y="726.9992">*</text><!--MD5=[e9093063cbce812edbb39001438d2b97]
link Visit to VisitEventInformation--><path d="M297.02,820.0531 C288.99,838.8931 279.97,860.0831 273.23,875.9131 " fill="none" id="Visit-&gt;VisitEventInformation" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="271.22,880.6431,278.4242,873.9276,273.1775,876.0422,271.0628,870.7955,271.22,880.6431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="207.3756" y="869.9115">события</text><!--MD5=[1e4d2d57c33ac4fbfb30d2a24337b1e6]
link Visit to VisitEvent--><path d="M346.45,820.0531 C359.42,839.0531 374.03,860.4531 384.86,876.3231 " fill="none" id="Visit-&gt;VisitEvent" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="387.82,880.6431,386.0331,870.9577,384.994,876.5183,379.4334,875.4793,387.82,880.6431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="344.1912" y="869.9115">типы</text><!--MD5=[590e6bbb54576a760ce8b0ee960b37fd]
@startuml
skinparam backgroundColor #FFFFFF
title VisitManager: ключевые классы обслуживания визитов

skinparam classAttributeIconSize 0
hide circle

package "Сервисный слой" {
  class VisitService {
    +Visit getVisit(branchId, visitId)
    +List<Visit> getVisits(branchId, queueId)
    +Visit createVisit(branchId, entryPointId, VisitParameters, printTicket)
    +Visit visitPostPone(branchId, visitId)
    +void deleteVisit(branchId, visitId)
  }
  class BranchService
  class EventService
  class DelayedEvents
  class PrinterService
  class SegmentationRule
  class CallRule
}

package "Интеграции" {
  class KeyCloackClient
}

package "Домен" {
  class Branch {
    +HashMap<String, Queue> queues
    +HashMap<String, ServicePoint> servicePoints
    +HashMap<String, User> users
    +HashMap<String, Visit> getAllVisits()
  }
  class Queue {
    +List<Visit> visits
  }
  class ServicePoint {
    +User user
    +Visit visit
    +List<Visit> visits
  }
  class User {
    +List<Visit> visits
  }
  class Visit {
    +String id
    +String status
    +ZonedDateTime createDateTime
    +List<VisitEvent> visitEvents
  }
  class VisitEventInformation
  enum VisitEvent
}

VisitService - -> BranchService : конфигурация отделения
VisitService - -> EventService : события визита
VisitService - -> DelayedEvents : отложенные события
VisitService - -> PrinterService : печать талонов
VisitService - -> KeyCloackClient : пользователи и роли
VisitService - -> SegmentationRule : сегментация потоков
VisitService - -> CallRule : правила вызова
BranchService - -> Branch : возвращает состояние

Branch "1" *- - "*" Queue
Branch "1" *- - "*" ServicePoint
Branch "1" *- - "*" User
Queue "1" o- - "*" Visit : ожидающие визиты
ServicePoint "1" o- - "*" Visit : пул визитов
ServicePoint "1" o- - "0..1" Visit : активный визит
User "1" o- - "*" Visit : обслуживаемые визиты
Visit - -> "события" VisitEventInformation
Visit - -> "типы" VisitEvent

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.2+13-58
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>