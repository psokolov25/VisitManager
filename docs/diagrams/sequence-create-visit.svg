<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="455px" preserveAspectRatio="none" style="width:846px;height:455px;" version="1.1" viewBox="0 0 846 455" width="846px" zoomAndPan="magnify"><defs><filter height="300%" id="f1qd09upxqp5we" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><rect width="100%" height="100%" fill="#FFFFFF"/><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="30" x2="30" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="137.5" x2="137.5" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="313" x2="313" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="507" x2="507" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="624" x2="624" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="744.5" x2="744.5" y1="86.2969" y2="368.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="805.5" x2="805.5" y1="86.2969" y2="368.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="8" y="82.9951">Client</text><ellipse cx="30.5" cy="13" fill="#FEFECE" filter="url(#f1qd09upxqp5we)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M30.5,21 L30.5,48 M17.5,29 L43.5,29 M30.5,48 L17.5,63 M30.5,48 L43.5,63 " fill="none" filter="url(#f1qd09upxqp5we)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="8" y="380.4873">Client</text><ellipse cx="30.5" cy="393.7891" fill="#FEFECE" filter="url(#f1qd09upxqp5we)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M30.5,401.7891 L30.5,428.7891 M17.5,409.7891 L43.5,409.7891 M30.5,428.7891 L17.5,443.7891 M30.5,428.7891 L43.5,443.7891 " fill="none" filter="url(#f1qd09upxqp5we)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="83.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="90.5" y="70.9951">Терминал/UI</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="83.5" y="367.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="90.5" y="387.4873">Терминал/UI</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="248" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="255" y="70.9951">VisitManager API</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="248" y="367.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="255" y="387.4873">VisitManager API</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="449" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="456" y="70.9951">BranchService</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="449" y="367.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="456" y="387.4873">BranchService</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="576" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="583" y="70.9951">VisitService</text><rect fill="#FEFECE" filter="url(#f1qd09upxqp5we)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="576" y="367.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="583" y="387.4873">VisitService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="722.5" y="82.9951">Redis</text><path d="M727,34 C727,24 745,24 745,24 C745,24 763,24 763,34 L763,60 C763,70 745,70 745,70 C745,70 727,70 727,60 L727,34 " fill="#FEFECE" filter="url(#f1qd09upxqp5we)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M727,34 C727,44 745,44 745,44 C745,44 763,44 763,34 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="722.5" y="380.4873">Redis</text><path d="M727,393.7891 C727,383.7891 745,383.7891 745,383.7891 C745,383.7891 763,383.7891 763,393.7891 L763,419.7891 C763,429.7891 745,429.7891 745,429.7891 C745,429.7891 727,429.7891 727,419.7891 L727,393.7891 " fill="#FEFECE" filter="url(#f1qd09upxqp5we)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M727,393.7891 C727,403.7891 745,403.7891 745,403.7891 C745,403.7891 763,403.7891 763,393.7891 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><path d="M782.5,60 L829.5,60 C834.5,60 834.5,73.1484 834.5,73.1484 C834.5,73.1484 834.5,86.2969 829.5,86.2969 L782.5,86.2969 C777.5,86.2969 777.5,73.1484 777.5,73.1484 C777.5,73.1484 777.5,60 782.5,60 " fill="#FEFECE" filter="url(#f1qd09upxqp5we)" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M829.5,60 C824.5,60 824.5,73.1484 824.5,73.1484 C824.5,86.2969 829.5,86.2969 829.5,86.2969 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="782.5" y="77.9951">Kafka</text><path d="M782.5,367.4922 L829.5,367.4922 C834.5,367.4922 834.5,380.6406 834.5,380.6406 C834.5,380.6406 834.5,393.7891 829.5,393.7891 L782.5,393.7891 C777.5,393.7891 777.5,380.6406 777.5,380.6406 C777.5,380.6406 777.5,367.4922 782.5,367.4922 " fill="#FEFECE" filter="url(#f1qd09upxqp5we)" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M829.5,367.4922 C824.5,367.4922 824.5,380.6406 824.5,380.6406 C824.5,393.7891 829.5,393.7891 829.5,393.7891 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="782.5" y="385.4873">Kafka</text><polygon fill="#A80036" points="125.5,113.4297,135.5,117.4297,125.5,121.4297,129.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="131.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="37.5" y="112.3638">Выбор услуг</text><polygon fill="#A80036" points="301.5,142.5625,311.5,146.5625,301.5,150.5625,305.5,146.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="137.5" x2="307.5" y1="146.5625" y2="146.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="144.5" y="141.4966">POST /entrypoint/.../visit</text><polygon fill="#A80036" points="495.5,171.6953,505.5,175.6953,495.5,179.6953,499.5,175.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="313.5" x2="501.5" y1="175.6953" y2="175.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="320.5" y="170.6294">Получить конфигурацию</text><polygon fill="#A80036" points="324.5,200.8281,314.5,204.8281,324.5,208.8281,320.5,204.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318.5" x2="506.5" y1="204.8281" y2="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="330.5" y="199.7622">Услуги существуют</text><polygon fill="#A80036" points="612,229.9609,622,233.9609,612,237.9609,616,233.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="313.5" x2="618" y1="233.9609" y2="233.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="320.5" y="228.895">Создать визит</text><polygon fill="#A80036" points="733,259.0938,743,263.0938,733,267.0938,737,263.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="739" y1="263.0938" y2="263.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="631" y="258.0278">Обновить кэш</text><polygon fill="#A80036" points="794,288.2266,804,292.2266,794,296.2266,798,292.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624" x2="800" y1="292.2266" y2="292.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="631" y="287.1606">VISIT_CREATED</text><polygon fill="#A80036" points="324.5,317.3594,314.5,321.3594,324.5,325.3594,320.5,321.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318.5" x2="623" y1="321.3594" y2="321.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="330.5" y="316.2935">Visit{id,ticket,queue}</text><polygon fill="#A80036" points="148.5,346.4922,138.5,350.4922,148.5,354.4922,144.5,350.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="142.5" x2="312.5" y1="350.4922" y2="350.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="154.5" y="345.4263">200 + визит</text><!--MD5=[282497d588ab0c2da20cdc178d673dab]
@startuml
skinparam backgroundColor #FFFFFF
actor Client
participant UI as "Терминал/UI"
participant API as "VisitManager API"
participant Branch as "BranchService"
participant Visit as "VisitService"
database Redis
queue Kafka
Client -> UI: Выбор услуг
UI -> API: POST /entrypoint/.../visit
API -> Branch: Получить конфигурацию
Branch - -> API: Услуги существуют
API -> Visit: Создать визит
Visit -> Redis: Обновить кэш
Visit -> Kafka: VISIT_CREATED
Visit - -> API: Visit{id,ticket,queue}
API - -> UI: 200 + визит
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.2+13-58
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>